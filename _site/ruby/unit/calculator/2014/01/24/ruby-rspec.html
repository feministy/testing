<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Unit testing: Ruby with RSpec</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/stylesheets/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/stylesheets/pure.css">
        <link rel="stylesheet" href="/stylesheets/main.css">

    </head>
    <body>

      <div class="pure-g">
        <div class="pure-u-1">
          <!-- nav menu -->
        </div>
      </div>

      <div class="pure-g">
        <div class="pure-u-1">
          <!-- pretty header of sorts -->
        </div>
      </div>

      <div class="pure-g">
        <div class="pure-u-1-5"></div>
        <div class="pure-u-3-5">
          <h1>Unit testing: Ruby with RSpec</h1>
<p class="meta">24 Jan 2014</p>

<div class="post">
<p>I often find that the best way to learn a new way of testing things is to use something simple that mimics a real-world object. I really like using a calculator as an example because it can be as complex or as simple as you want it to be.</p>

<p>This tutorial assumes that you:</p>

<ul>
<li>know how to read, write, and run Ruby</li>
<li>have familiarity with Ruby Gems</li>
<li>know what unit testing is</li>
<li>have downloaded the calculator (how to navigate)</li>
</ul>

<p>If any of that is beyond the scope of your abilities, you can likely still follow along.</p>

<h2>Download calculator</h2>

<h2>Our test object: a calculator</h2>

<p>Here we have a simple Ruby calculator that has addition, subtraction, and multiplication calculating functionalities. It also allows you to clear or remove the last number inserted. The purpose of this calculator is to mimic a simple real-world object that many people are familiar with so you can learn RSpec by testing something you already know how to use:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno"> 1</span> <span class="k">class</span> <span class="nc">Calculator</span>
<span class="lineno"> 2</span>   <span class="kp">attr_reader</span> <span class="ss">:nums</span>
<span class="lineno"> 3</span> 
<span class="lineno"> 4</span>   <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="lineno"> 5</span>     <span class="vi">@nums</span> <span class="o">||=</span> <span class="o">[]</span>
<span class="lineno"> 6</span>     <span class="vi">@nums</span> <span class="o">&lt;&lt;</span> <span class="n">n</span>
<span class="lineno"> 7</span>   <span class="k">end</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span>   <span class="k">def</span> <span class="nf">multiply</span>
<span class="lineno">10</span>     <span class="vi">@nums</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:*</span><span class="p">)</span>
<span class="lineno">11</span>   <span class="k">end</span>
<span class="lineno">12</span> 
<span class="lineno">13</span>   <span class="k">def</span> <span class="nf">add</span>
<span class="lineno">14</span>     <span class="vi">@nums</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:+</span><span class="p">)</span>
<span class="lineno">15</span>   <span class="k">end</span>
<span class="lineno">16</span> 
<span class="lineno">17</span>   <span class="k">def</span> <span class="nf">subtract</span>
<span class="lineno">18</span>     <span class="vi">@nums</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:-</span><span class="p">)</span>
<span class="lineno">19</span>   <span class="k">end</span>
<span class="lineno">20</span> 
<span class="lineno">21</span>   <span class="k">def</span> <span class="nf">clear</span>
<span class="lineno">22</span>     <span class="vi">@nums</span> <span class="o">=</span> <span class="o">[]</span>
<span class="lineno">23</span>   <span class="k">end</span>
<span class="lineno">24</span> 
<span class="lineno">25</span>   <span class="k">def</span> <span class="nf">remove_last</span>
<span class="lineno">26</span>     <span class="vi">@nums</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="lineno">27</span>     <span class="vi">@nums</span>
<span class="lineno">28</span>   <span class="k">end</span>
<span class="lineno">29</span> <span class="k">end</span>
</code></pre></div>

<h3>Using the calculator</h3>

<p>If you want to play with the calculator interactively: load up irb (<code>$ irb</code>). Inside of <code>irb</code>:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno">1</span> <span class="nb">load</span> <span class="s1">&#39;calculator.rb&#39;</span>
</code></pre></div>

<p>And now you have access to your calculator file in <code>irb</code> where you can play.</p>

<p>First you create a Calculator object:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno">1</span> <span class="n">calc</span> <span class="o">=</span> <span class="no">Calculator</span><span class="o">.</span><span class="n">new</span>
</code></pre></div>

<p>Then, you add numbers to your calculator with <code>push</code>:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno">1</span> <span class="n">calc</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">46</span><span class="p">)</span>
<span class="lineno">2</span> <span class="n">calc</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>

<p>You can add as many or as few numbers as you want to your calculator.</p>

<p>After you&#39;ve added the numbers you want into your calculator, you can do math:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno">1</span> <span class="n">calc</span><span class="o">.</span><span class="n">add</span> <span class="c1"># =&gt; 48</span>
<span class="lineno">2</span> <span class="n">calc</span><span class="o">.</span><span class="n">multiply</span> <span class="c1"># =&gt; 92</span>
<span class="lineno">3</span> <span class="n">calc</span><span class="o">.</span><span class="n">subtract</span> <span class="c1"># =&gt; 44</span>
</code></pre></div>

<p>If you want to remove the last number you added:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno">1</span> <span class="n">calc</span><span class="o">.</span><span class="n">remove_last</span> <span class="c1"># =&gt; [46]</span>
</code></pre></div>

<p>Or, when you&#39;re ready to start over, you can:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno">1</span> <span class="n">calc</span><span class="o">.</span><span class="n">clear</span> <span class="c1"># =&gt; []</span>
</code></pre></div>

<p>At any point, you can check the contents of your calculator with:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno">1</span> <span class="n">calc</span><span class="o">.</span><span class="n">nums</span> <span class="c1"># =&gt; [46]</span>
</code></pre></div>

<p><strong>This calculator is not destructive</strong>. So if you do:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno">1</span> <span class="n">calc</span> <span class="o">=</span> <span class="no">Calculator</span><span class="o">.</span><span class="n">new</span>
<span class="lineno">2</span> <span class="n">calc</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="lineno">3</span> <span class="n">calc</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="lineno">4</span> <span class="n">calc</span><span class="o">.</span><span class="n">nums</span> <span class="c1"># =&gt; [3, 5]</span>
<span class="lineno">5</span> <span class="n">calc</span><span class="o">.</span><span class="n">add</span> <span class="c1"># =&gt; 8</span>
<span class="lineno">6</span> <span class="n">calc</span><span class="o">.</span><span class="n">nums</span> <span class="c1"># =&gt; [3, 5]</span>
</code></pre></div>

<p>You can see that <code>calc.nums</code> does not change. The contents are protected.</p>

<h2>Running existing tests</h2>

<h6>ruby-calculator-rspec-01</h6>

<p>Before you start modifying the code or writing your own tests, you should become familiar with the existing tests.</p>

<p>First, you will need to install RSpec. This requires RubyGems. Install with the command <code>gem install rspec</code>.</p>

<p>Second, you will need to have Ruby 1.9.3 or greater. The tests currently pass with Ruby 2.0.0 and 1.9.3; I cannot guarantee functionality for any other version of Ruby.</p>

<p>To run the tests, type: <code>rspec calculator_spec.rb</code></p>

<p>This will return some pretty formatted information for you.</p>

<div class="highlight"><pre><code class="ruby"><span class="no">Calculator</span>
  <span class="c1">#multiply</span>
    <span class="n">works</span>
  <span class="c1">#push</span>
    <span class="n">adds</span> <span class="kp">new</span> <span class="n">numbers</span>
    <span class="n">accumulates</span> <span class="n">numbers</span>
    <span class="n">requires</span> <span class="n">an</span> <span class="n">argument</span>
    <span class="n">does</span> <span class="ow">not</span> <span class="n">accept</span> <span class="n">more</span> <span class="n">than</span> <span class="mi">1</span> <span class="n">argument</span>
  <span class="c1">#nums</span>
    <span class="n">should</span> <span class="n">be</span> <span class="kp">nil</span> <span class="n">on</span> <span class="n">init</span>

<span class="no">Finished</span> <span class="k">in</span> <span class="mi">0</span><span class="o">.</span><span class="mo">00516</span> <span class="n">seconds</span>
<span class="mi">6</span> <span class="n">examples</span><span class="p">,</span> <span class="mi">0</span> <span class="n">failures</span>

<span class="no">Randomized</span> <span class="n">with</span> <span class="n">seed</span> <span class="mi">21811</span>
</code></pre></div>

<p>The test run order is randomized to help you spot any potential problems with your code or your test suite.</p>

<h2>Writing more calculator tests</h2>

<p>The <code>calculator_spec.rb</code> file has a few contexts with no tests in them. You should write some! Here are some helpful resources:</p>

<ul>
<li><a href="http://betterspecs.org/">Better Specs</a> - comparison of good specs and bad specs</li>
<li><a href="http://rubydoc.info/gems/rspec-expectations/frames">RSpec Expectations</a> - guides for using RSpec</li>
</ul>

<p>Some things to keep in mind:</p>

<ul>
<li>Each test block (starts with <code>it &#39;should do this thing&#39; do</code>) should contain only one assertion. Assertions are the lines that include <code>expect</code> (<code>expect(@calc.nums).to be_nil</code>).</li>
<li>Anything in a <code>before</code> block is run before each test.</li>
<li>Variables with an <code>@</code> symbol in front of them are instance variables and can be used throughout your file.</li>
<li>This test file is intentionally not perfect. What tests are missing for <code>#push</code> and <code>#initialize</code>? Is there functionality missing from the Calculator itself? Can the tests be refactored?</li>
</ul>

<h2>Anatomy of a test</h2>

<p>Here is a simple test for addition (not in <code>calculator_spec.rb</code>):</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno">1</span> <span class="n">it</span> <span class="s1">&#39;returns the sum of all numbers&#39;</span> <span class="k">do</span>
<span class="lineno">2</span>   <span class="n">calc</span> <span class="o">=</span> <span class="no">Calculator</span><span class="o">.</span><span class="n">new</span>
<span class="lineno">3</span>   <span class="n">calc</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="lineno">4</span>   <span class="n">calc</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="lineno">5</span>   <span class="n">calc</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="lineno">6</span>   <span class="n">total</span> <span class="o">=</span> <span class="n">calc</span><span class="o">.</span><span class="n">add</span>
<span class="lineno">7</span>   <span class="n">expect</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="lineno">8</span> <span class="k">end</span>
</code></pre></div>

<p>Now lets break this down.</p>

<p>This is the description of what our test is actually testing for.</p>

<div class="highlight"><pre><code class="ruby"><span class="n">it</span> <span class="s1">&#39;returns the sum of all numbers&#39;</span> <span class="k">do</span>
</code></pre></div>

<p>We have to make a new Calculator object:</p>

<div class="highlight"><pre><code class="ruby">  <span class="n">calc</span> <span class="o">=</span> <span class="no">Calculator</span><span class="o">.</span><span class="n">new</span>
</code></pre></div>

<p>And put some numbers into our Calculator:</p>

<div class="highlight"><pre><code class="ruby">  <span class="n">calc</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">calc</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
  <span class="n">calc</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>

<p>Now that our calculator has numbers, we can add them together to get a total using the add method.</p>

<div class="highlight"><pre><code class="ruby">  <span class="n">total</span> <span class="o">=</span> <span class="n">calc</span><span class="o">.</span><span class="n">add</span>
</code></pre></div>

<p>This is our assertion. Read in plain English: <code>we expect the total to be 10</code>. Our test will pass if the total is 10. Our test will fail is the total is not 10 (the Integer).</p>

<div class="highlight"><pre><code class="ruby">  <span class="n">expect</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>

</div>

        </div>
        <div class="pure-u-1-5"></div>
      </div>

    <script type="text/javascript" src="//use.typekit.net/qng2ufh.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    </body>
</html>
